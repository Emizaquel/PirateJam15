[gd_scene load_steps=11 format=3 uid="uid://ceb4ro2rafjt6"]

[ext_resource type="PackedScene" uid="uid://chrfbhfq6s0so" path="res://Shadows/vertical shadow.tscn" id="1_brjev"]
[ext_resource type="PackedScene" uid="uid://c3xlcm3qxer5e" path="res://Shadows/horizontal shadow.tscn" id="1_eaybk"]
[ext_resource type="Shader" path="res://Shadows/code/shadow.gdshader" id="2_ip7jd"]
[ext_resource type="Texture2D" uid="uid://brmqiloxvahky" path="res://Shadows/Plague_doc.png" id="4_2m2mj"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_lu1kg"]
size = Vector2(50, 50)

[sub_resource type="GDScript" id="GDScript_f8li1"]
script/source = "extends CharacterBody2D

@export var hurt_indicator:Node2D

const SPEED = 300.0
const JUMP_VELOCITY = -400.0

# Get the gravity from the project settings to be synced with RigidBody nodes.
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")
@onready var shadows = [
	$shadow_border1,
	$shadow_border2,
	$shadow_border3,
	$shadow_border4,
	$shadow_border5,
	$shadow_border6,
	$shadow_border7,
	$shadow_border8,
]

var fullSpawned = false

#func _ready():
	#$\"../Horizontal Shadow/collider\".disabled = true

func _physics_process(delta):
	# Add the gravity.
	#if not is_on_floor():
		#velocity.y += gravity * delta

	# Handle jump.
	if Input.is_action_just_pressed(\"ui_accept\") and is_on_floor():
		velocity.y = JUMP_VELOCITY

	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	var horizontal = Input.get_axis(\"ui_left\", \"ui_right\")
	if horizontal:
		velocity.x = horizontal * SPEED
	else:
		velocity.x = move_toward(velocity.x, 0, SPEED)
		
	var vertical = Input.get_axis(\"ui_up\", \"ui_down\")
	if vertical:
		velocity.y = vertical * SPEED
	else:
		velocity.y = move_toward(velocity.y, 0, SPEED)

	move_and_slide()

func _process(delta):
	if fullSpawned:
		for shadow in shadows:
			if(not shadow.has_overlapping_areas()):
				hurt_indicator.visible = true
				return
	hurt_indicator.visible = false


func _on_spawn_grace_timeout():
	fullSpawned = true
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ic5ul"]
shader = ExtResource("2_ip7jd")
shader_parameter/shadow_darkness = 0.2

[sub_resource type="GDScript" id="GDScript_ux5cg"]
script/source = "extends Polygon2D

# Called when the node enters the scene tree for the first time.
func _ready():
	var points = []
	var num_sides = 4.0
	var height = 10.0
	var radius = 5.0
	var center_segment = height - (radius*2)
	if((center_segment)<0):
		radius = height/2
		center_segment = 0
	center_segment = center_segment/2
	var angles = range(num_sides+1)
	for i in angles:
		i = i*PI/num_sides
		points.append(Vector2(sin(i)*radius + center_segment, cos(i)*radius))
	var temp = []
	for point in points:
		temp.append(Vector2(0-point.x, 0-point.y))
	points.append_array(temp)
	polygon = points
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	pass
"

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_jivgo"]
radius = 5.0
height = 10.0

[sub_resource type="CircleShape2D" id="CircleShape2D_w407t"]
radius = 1.0

[node name="Test" type="Node2D"]

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="ColorRect" type="ColorRect" parent="CanvasLayer"]
custom_minimum_size = Vector2(100, 0)
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0.574328, 0.574328, 0.574328, 1)

[node name="Building" type="Node2D" parent="CanvasLayer"]
position = Vector2(156, 79)

[node name="Horizontal Shadow" parent="CanvasLayer/Building" node_paths=PackedStringArray("daylight") instance=ExtResource("1_eaybk")]
polygon = PackedVector2Array(0, -50, -100, -50, -100, 0, 0, 0)
daylight = NodePath("../../../Daylight")

[node name="Horizontal Shadow2" parent="CanvasLayer/Building" node_paths=PackedStringArray("daylight") instance=ExtResource("1_eaybk")]
position = Vector2(50, 0)
polygon = PackedVector2Array(0, -50, -100, -50, -100, 0, 0, 0)
daylight = NodePath("../../../Daylight")

[node name="Vertical Shadow" parent="CanvasLayer/Building" node_paths=PackedStringArray("daylight") instance=ExtResource("1_brjev")]
polygon = PackedVector2Array(0, 0, 0, 100, 50, 100, 50, 0)
daylight = NodePath("../../../Daylight")

[node name="Polygon2D" type="Polygon2D" parent="CanvasLayer/Building"]
polygon = PackedVector2Array(50, 0, 50, -50, 0, -50, 0, 0)

[node name="StaticBody2D" type="StaticBody2D" parent="CanvasLayer/Building"]
position = Vector2(26, -26)

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/Building/StaticBody2D"]
position = Vector2(-1, 1)
shape = SubResource("RectangleShape2D_lu1kg")

[node name="Area2D" type="Area2D" parent="CanvasLayer/Building"]
position = Vector2(26, -26)
collision_layer = 65536
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/Building/Area2D"]
position = Vector2(-1, 1)
shape = SubResource("RectangleShape2D_lu1kg")

[node name="Building2" type="Node2D" parent="CanvasLayer"]
position = Vector2(194, 139)

[node name="Horizontal Shadow" parent="CanvasLayer/Building2" node_paths=PackedStringArray("daylight") instance=ExtResource("1_eaybk")]
polygon = PackedVector2Array(0, -50, -100, -50, -100, 0, 0, 0)
daylight = NodePath("../../../Daylight")

[node name="Horizontal Shadow2" parent="CanvasLayer/Building2" node_paths=PackedStringArray("daylight") instance=ExtResource("1_eaybk")]
position = Vector2(50, 0)
polygon = PackedVector2Array(0, -50, -100, -50, -100, 0, 0, 0)
daylight = NodePath("../../../Daylight")

[node name="Vertical Shadow" parent="CanvasLayer/Building2" node_paths=PackedStringArray("daylight") instance=ExtResource("1_brjev")]
polygon = PackedVector2Array(0, 0, 0, 100, 50, 100, 50, 0)
daylight = NodePath("../../../Daylight")

[node name="Polygon2D" type="Polygon2D" parent="CanvasLayer/Building2"]
polygon = PackedVector2Array(50, 0, 50, -50, 0, -50, 0, 0)

[node name="StaticBody2D" type="StaticBody2D" parent="CanvasLayer/Building2"]
position = Vector2(26, -26)

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/Building2/StaticBody2D"]
position = Vector2(-1, 1)
shape = SubResource("RectangleShape2D_lu1kg")

[node name="Area2D" type="Area2D" parent="CanvasLayer/Building2"]
position = Vector2(26, -26)
collision_layer = 65536
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/Building2/Area2D"]
position = Vector2(-1, 1)
shape = SubResource("RectangleShape2D_lu1kg")

[node name="CharacterBody2D" type="CharacterBody2D" parent="CanvasLayer" node_paths=PackedStringArray("hurt_indicator")]
position = Vector2(128, 64)
motion_mode = 1
script = SubResource("GDScript_f8li1")
hurt_indicator = NodePath("Polygon2D3")

[node name="Polygon2D2" type="Polygon2D" parent="CanvasLayer/CharacterBody2D"]
material = SubResource("ShaderMaterial_ic5ul")
color = Color(0, 0, 0, 1)
script = SubResource("GDScript_ux5cg")

[node name="Polygon2D" type="Sprite2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(1, -14)
scale = Vector2(0.2, 0.2)
texture = ExtResource("4_2m2mj")

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D"]
shape = SubResource("CapsuleShape2D_jivgo")

[node name="shadow_border1" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(0, -6)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border1"]
position = Vector2(0, -1)
shape = SubResource("CircleShape2D_w407t")

[node name="shadow_border2" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(-7, -5)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border2"]
position = Vector2(0, -1)
shape = SubResource("CircleShape2D_w407t")

[node name="shadow_border3" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(-11, 0)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border3"]
shape = SubResource("CircleShape2D_w407t")

[node name="shadow_border4" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(-7, 6)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border4"]
shape = SubResource("CircleShape2D_w407t")

[node name="shadow_border5" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(0, 7)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border5"]
shape = SubResource("CircleShape2D_w407t")

[node name="shadow_border6" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(7, -5)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border6"]
position = Vector2(0, -1)
shape = SubResource("CircleShape2D_w407t")

[node name="shadow_border7" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(11, 0)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border7"]
shape = SubResource("CircleShape2D_w407t")

[node name="shadow_border8" type="Area2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(7, 6)
collision_layer = 0
collision_mask = 65536

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/CharacterBody2D/shadow_border8"]
shape = SubResource("CircleShape2D_w407t")

[node name="SpawnGrace" type="Timer" parent="CanvasLayer/CharacterBody2D"]
wait_time = 0.1
autostart = true

[node name="Polygon2D3" type="Polygon2D" parent="CanvasLayer/CharacterBody2D"]
position = Vector2(0, -3)
color = Color(0.747501, 0, 0.166365, 1)
polygon = PackedVector2Array(-7, 7, -1, 1, -7, -5, -6, -6, 0, 0, 6, -6, 7, -5, 1, 1, 7, 7, 6, 8, 0, 2, -6, 8)

[node name="Daylight" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 60.0
autostart = true

[connection signal="timeout" from="CanvasLayer/CharacterBody2D/SpawnGrace" to="CanvasLayer/CharacterBody2D" method="_on_spawn_grace_timeout"]
